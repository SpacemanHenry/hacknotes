# Fuzzing for buffer overflows

## Questions to ask yourself
  *  What data format does the target service expect?
      *  What data within that format is variable?
      *  What formatting must be maintained?
      *  Does the nature of the target service imply any bad characters?

## Things to remember
  *  A copy of the target software is needed for exploit development

## Useful tools
  *  [`boofuzz`](https://boofuzz.readthedocs.io/en/stable/index.html) and [`spike`](https://www.kali.org/tools/spike/) for fuzzing buffer overflows
  *  [`netstat`](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/netstat), [`netcat`](http://www.stearns.org/nc/), and [`wireshark`](https://www.wireshark.org/) for initial analysis

## Initial analysis
  *  `netstat` to find what port number(s) the target program might use
  *  `wireshark` to view data within captured packets
      *  Analyze data format and re-create during fuzzing
      *  Compare known protocols to [RFCs](https://www.ietf.org/process/rfcs/) for fuzzing opportunities
  *  `netcat` for interacting with services with no known client

```
netstat -anob
```

```
nc 10.0.0.1 9999
```

## Fuzzing with boofuzz
  *  `boofuzz` for easily defining and fuzzing protocol message formats
      *  [Install guide](https://boofuzz.readthedocs.io/en/stable/user/install.html) for installing `boofuzz` in [`venv`](https://docs.python.org/3/library/venv.html)
      *  [Quickstart guide](https://boofuzz.readthedocs.io/en/stable/user/quickstart.html) and [GitHub repo](https://github.com/jtpereyda/boofuzz/tree/master/examples) for more/better examples
      *  `boofuzz` provides [monitoring funcs](https://boofuzz.readthedocs.io/en/stable/user/monitors.html#) for detecting crashes, restarting target, etc.

```
from boofuzz import *
session = Session(target=Target(connection=TCPSocketConnection('10.0.0.1', 9999)))
session.connect(Request(children=(
    Static("prefix", "USER"),
    Delim("space", " "),
    String("fuzz", ""),
    Static("postfix", "\r\n"),
)))
session.fuzz()
```

## Fuzzing with Spike
  *  `spike` has many [pre-existing scripts](https://gitlab.com/kalilinux/packages/spike/-/tree/kali/master/src/audits) for various protocols
      *  A [scripting language](https://resources.infosecinstitute.com/topics/hacking/intro-to-fuzzing/) exists to match custom protocols

```
locate .spk
```

```
cat example.spk 
s_readline();
s_string("USER ");
s_string_variable("");
s_string("\r\n");
```

```
generic_send_tcp 10.0.0.1 9999 example.spk 0 0
```
