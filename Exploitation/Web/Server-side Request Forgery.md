# Server-side Request Forgery

## Things to remember
  *  PayloadsAllTheThings for [SSRF payloads and techniques](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)
  *  SSRF involves coercing the server into performing requests to another service
      *  Leverage control of requested URL to interact with other services
  *  Metadata services of cloud compute resources are popular targets of SSRF payloads

## Useful tools
  *  [`wfuzz`](https://www.kali.org/tools/wfuzz/) and [`ffuf`](https://github.com/ffuf/ffuf) for manually fuzzing web app inputs for SSRF
  *  [`SSRFmap`](https://github.com/swisskyrepo/SSRFmap) for automated SSRF fuzzing
  *  [`Burpsuite`](https://portswigger.net/burp) to perform precise testing and to verify fuzzing requests

## Fuzzing for SSRF
  *  `SSRFmap` for automated SSRF fuzzing/targeting
      *  Rather sensitive, proxy through `Burp` to verify request structure
  *  `wfuzz` and `ffuf` for manual SSRF fuzzing
  *  Carefully parse HTTP POST requests before using `wfuzz`
      *  Be specific with things like cookies, headers, URL structure, etc.
      *  Failing to provide these values can produce ineffective requests
  *  `ffuf` can parse requests from text files
      *  Easier handling of more complex POST requests
      *  No recursive grep, consider `Burp Intruder` in these cases

```
git clone https://github.com/swisskyrepo/SSRFmap && cd SSRFmap
pip3 install -r requirements.txt
python3 ssrfmap.py -r req.txt -m portscan -v --proxy http://127.0.0.1:8080
```

```
wfuzz -w /path/to/ssrf.txt -b 'exampleCookie=cookieValue' 'http://10.0.0.1/ssrf?param=FUZZ'
wfuzz -w /path/to/ssrf.txt -H 'exampleHeader: headerValue' -d 'param=FUZZ' 'http://10.0.0.1/ssrf'
```

```
ffuf -request req.txt --request-proto http -w /path/to/ssrf.txt -v
```

## Exploiting SSRF
  *  `Burp Repeater` for precise SSRF targeting
  *  `ffuf` for fuzzing SSRF targets
  *  Leverage SSRF to scan localhost for any internal services
      *  Once an internal service is located, search for ways to leak/infer response data
      *  Repeat applicable HTTP service enumerations to map out internal services
  *  Consider trying other URL schemes such as `file://` for arbitrary file read
      *  Many more [URL schemes](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery#protocols) are available
      *  Restricted URL schemes/resources? Serve a redirect!

```
ffuf -request req.txt --request-proto http -w /path/to/port-numbers.txt -v
ffuf -request req.txt --request-proto http -w /path/to/target-urls.txt -v
```
